(()=>{var t={224:function(t,e,n){t=n.nmd(t),function(n,r){"use strict";var i={};n.PubSub?(i=n.PubSub,console.warn("PubSub already loaded, using existing version")):(n.PubSub=i,function(t){var e={},n=-1,r="*";function i(t,e,n){try{t(e,n)}catch(t){setTimeout(function(t){return function(){throw t}}(t),0)}}function s(t,e,n){t(e,n)}function a(t,n,r,a){var o,c=e[n],l=a?s:i;if(Object.prototype.hasOwnProperty.call(e,n))for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&l(c[o],t,r)}function o(t){var n=String(t);return Boolean(Object.prototype.hasOwnProperty.call(e,n)&&function(t){var e;for(e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!0;return!1}(e[n]))}function c(t,e,n,i){var s=function(t,e,n){return function(){var i=String(t),s=i.lastIndexOf(".");for(a(t,t,e,n);-1!==s;)s=(i=i.substr(0,s)).lastIndexOf("."),a(t,i,e,n);a(t,r,e,n)}}(t="symbol"==typeof t?t.toString():t,e,i);return!!function(t){for(var e=String(t),n=o(e)||o(r),i=e.lastIndexOf(".");!n&&-1!==i;)i=(e=e.substr(0,i)).lastIndexOf("."),n=o(e);return n}(t)&&(!0===n?s():setTimeout(s,0),!0)}t.publish=function(e,n){return c(e,n,!1,t.immediateExceptions)},t.publishSync=function(e,n){return c(e,n,!0,t.immediateExceptions)},t.subscribe=function(t,r){if("function"!=typeof r)return!1;t="symbol"==typeof t?t.toString():t,Object.prototype.hasOwnProperty.call(e,t)||(e[t]={});var i="uid_"+String(++n);return e[t][i]=r,i},t.subscribeAll=function(e){return t.subscribe(r,e)},t.subscribeOnce=function(e,n){var r=t.subscribe(e,(function(){t.unsubscribe(r),n.apply(this,arguments)}));return t},t.clearAllSubscriptions=function(){e={}},t.clearSubscriptions=function(t){var n;for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&0===n.indexOf(t)&&delete e[n]},t.countSubscriptions=function(t){var n,r,i=0;for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&0===n.indexOf(t)){for(r in e[n])i++;break}return i},t.getSubscriptions=function(t){var n,r=[];for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&0===n.indexOf(t)&&r.push(n);return r},t.unsubscribe=function(n){var r,i,s,a="string"==typeof n&&(Object.prototype.hasOwnProperty.call(e,n)||function(t){var n;for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&0===n.indexOf(t))return!0;return!1}(n)),o=!a&&"string"==typeof n,c="function"==typeof n,l=!1;if(!a){for(r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(i=e[r],o&&i[n]){delete i[n],l=n;break}if(c)for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&i[s]===n&&(delete i[s],l=!0)}return l}t.clearSubscriptions(n)}}(i)),void 0!==t&&t.exports&&(e=t.exports=i),e.PubSub=i,t.exports=e=i}("object"==typeof window&&window||this)}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={id:r,loaded:!1,exports:{}};return t[r].call(s.exports,s,s.exports,n),s.loaded=!0,s.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{"use strict";var t=n(224),e=n.n(t);function r(t,n){const r=document.createElement("div");return r.classList.add("square"),r.setAttribute("data-x",t),r.setAttribute("data-y",n),r.addEventListener("click",(t=>{const{currentTarget:n,target:r}=t,i={x:Number(r.getAttribute("data-x")),y:Number(r.getAttribute("data-y")),boardId:Number(n.parentElement.getAttribute("data-board-id"))};e().publish("square-clicked",i)})),r.addEventListener("dragenter",(t=>{t.preventDefault()})),r.addEventListener("dragover",(t=>{t.preventDefault()})),r.addEventListener("drop",(t=>{const{target:n,currentTarget:r}=t,s=Number(r.parentElement.getAttribute("data-board-id"));if(s!==Number(i.parentElement.parentElement.getAttribute("data-board-id")))return;const a=i.children[0],o={oldX:Number(a.getAttribute("data-x")),oldY:Number(a.getAttribute("data-y")),newX:Number(n.getAttribute("data-x")),newY:Number(n.getAttribute("data-y")),boardId:s};e().publish("ship-dropped",o)})),r}let i;const s=class{isDraggingEnabled=!1;shipsContainer=[];constructor(t,e){this.board=t,this.id=e,this.initializeBoard()}cleanBoard(){const t=Array.from(this.board.children);this.shipsContainer=[],t.forEach((t=>{t.replaceChildren(),t.classList.remove("square-hit"),t.classList.remove("square-ship-hit")}))}initializeBoard(){this.board.setAttribute("data-board-id",this.id);for(let t=0;t<10;t+=1)for(let e=0;e<10;e+=1){const n=r(e,t);this.board.append(n)}}receiveAttack(t,e){const n=this.getShipPart(t,e),r=null!=n,i=this.getSquare(t,e);null!=i&&(r?i.classList.add("square-ship-hit"):i.classList.add("square-hit")),n&&n.classList.add("ship-part-hit")}placeShip(t,n,r,s){const a=function(t,n,r,s,a){const o=document.createElement("div");o.classList.add("ship"),r?o.classList.add("ship-horizontal"):o.classList.add("ship-vertical");for(let e=0;e<s;e+=1){const i=document.createElement("div");i.classList.add("ship-part"),o.appendChild(i),r?(i.setAttribute("data-x",t+e),i.setAttribute("data-y",n)):(i.setAttribute("data-x",t),i.setAttribute("data-y",n+e))}return o.addEventListener("dragstart",(t=>{i=t.target})),o.addEventListener("dblclick",(t=>{const{currentTarget:n}=t,r=Number(n.parentElement.parentElement.getAttribute("data-board-id")),i=n.children[0],s={shipX:Number(i.getAttribute("data-x")),shipY:Number(i.getAttribute("data-y")),boardId:r};e().publish("ship-rotated",s)})),o.setAttribute("draggable",a),o}(t,n,r,s,this.isDraggingEnabled);this.getSquare(t,n).append(a)}removeShip(t,e){this.board.querySelector(`.square[data-x='${t}'][data-y='${e}']`).textContent=""}getSquare(t,e){return this.board.querySelector(`[data-x="${t}"][data-y="${e}"]`)}enableDragging(){this.isDraggingEnabled=!0,this.board.querySelectorAll(".ship").forEach((t=>{t.setAttribute("draggable","true")}))}disableDragging(){this.isDraggingEnabled=!1,this.board.querySelectorAll(".ship").forEach((t=>{t.setAttribute("draggable","false")}))}hideShips(){this.board.childNodes.forEach((t=>{const e=t.getElementsByClassName("ship")[0];e&&(e.remove(),this.shipsContainer.push(e))}))}showShips(){this.shipsContainer.forEach((t=>{const e=t.childNodes[0],n=Number(e.getAttribute("data-x")),r=Number(e.getAttribute("data-y"));this.getSquare(n,r).appendChild(t)}))}getShipPart(t,e){const n=this.board.querySelector(`.ship-part[data-x='${t}'][data-y='${e}']`);if(null!=n)return n;const r=this.shipsContainer.reduce(((t,e)=>{const n=e.childNodes;return t.concat(...n)}),[]);return r.length>0?r.find((n=>{const r=Number(n.getAttribute("data-x"))===t,i=Number(n.getAttribute("data-y"))===e;return r&&i})):void 0}},a=class{constructor(t,e,n,r){this.hits=0,this.startX=t,this.startY=e,this.isAxisX=n,this.length=r}hit(){this.hits+=1}isSunk(){return this.hits>=this.length}};function o(t,e,n,r){const i=[];if(!0===n)for(let n=t;n-t<r;n+=1)i.push([n,e]);else if(!1===n)for(let n=e;n-e<r;n+=1)i.push([t,n]);return i}function c(t,e,n,r){const i=[];if(n){for(let n=t;n-t<r;n+=1){const t=[n,e-1],r=[n,e+1];d(...t)&&i.push(t),d(...r)&&i.push(r)}const n=t-1,s=t+r;for(let t=-1;t<=1;t+=1){const r=[n,e+t],a=[s,e+t];d(...r)&&i.push(r),d(...a)&&i.push(a)}}else{for(let n=e;n-e<r;n+=1){const e=[t-1,n],r=[t+1,n];d(...e)&&i.push(e),d(...r)&&i.push(r)}const n=e-1,s=e+r;for(let e=-1;e<=1;e+=1){const r=[t+e,n],a=[t+e,s];d(...r)&&i.push(r),d(...a)&&i.push(a)}}return i}function l(t,e){const n=[];for(let r=t-1;r<=t+1;r+=1)for(let i=e-1;i<=e+1;i+=1)r===t&&i===e||!d(r,i)||n.push([r,i]);return n}function d(t,e){return t>=0&&t<=9&&e>=0&&e<=9}function u(){const t=[];for(let e=0;e<10;e+=1)for(let n=0;n<10;n+=1)t.push([e,n]);return t}function h(t,e,n,r){let i;return i=n?[t+r-1,e]:[t,e+r-1],i}function p(t,e){return t.filter((t=>-1===e.findIndex((e=>t.toString()===e.toString()))))}const b=function(t){return Math.floor(Math.random()*t)};function f(){const t=[];for(let e=0;e<10;e+=1){const n=[];for(let t=0;t<10;t+=1){const r={isHit:!1,ship:null,x:e,y:t};n.push(r)}t.push(n)}return t}const m=class{constructor(){this.board=f()}placeShip(t,e,n,r){if(!this.isLegalToPlaceShip(t,e,n,r))throw new Error("Ship out of bound");const i=new a(t,e,n,r);o(t,e,n,r).forEach((([t,e])=>{this.board[t][e].ship=i}))}removeShip(t,e){this.getShipCoords(t,e).forEach((([t,e])=>{this.board[t][e].ship=null}))}receiveAttack(t,e){const n=this.board[t][e];!1===n.isHit&&(n.isHit=!0,n.ship&&n.ship.hit())}areAllSunk(){return this.board.flat().every((t=>!(null!=t.ship&&!t.ship.isSunk())))}calculateAttack(){const t=u(),e=t.filter((([t,e])=>{const n=this.isHit(t,e),r=this.isShip(t,e),i=this.isSunk(t,e);return n&&r&&!i})).reduce(((t,e)=>{const[n,r]=e,i=this.getShip(n,r),s=function(t,e){const n=[],r=[t,e-1];d(...r)&&n.push(r);const i=[t,e+1];return d(...i)&&n.push(i),n}(n,r),a=function(t,e){const n=[],r=[t-1,e];d(...r)&&n.push(r);const i=[t+1,e];return d(...i)&&n.push(i),n}(n,r);let o=[];o=i.hits>1?i.isAxisX?a:s:a.concat(s);const c=o.filter((([t,e])=>!this.isHit(t,e)));return t.concat(c)}),[]);if(e.length>0)return e[b(e.length)];const n=t.filter((([t,e])=>!this.isHit(t,e)));return n[b(n.length)]}isLegalToPlaceShip(t,e,n,r){const i=function(t,e,n,r){return(!0===n?t+r:e+r)-1>9}(t,e,n,r);return!i&&(!o(t,e,n,r).some((([t,e])=>null!=this.board[t][e].ship))&&!c(t,e,n,r).some((([t,e])=>null!=this.board[t][e].ship)))}getShipCoords(t,e){if(!this.isShip(t,e))return[];const n=l(t,e),r=[...n,[t,e]],i=[[t,e]];for(;n.length>0;){const[t,e]=n.pop();if(!0===this.isShip(t,e)){i.push([t,e]);const s=l(t,e).filter((t=>!r.some((e=>{return n=t,r=e,JSON.stringify(n)===JSON.stringify(r);var n,r}))));r.push(...s),n.push(...s)}}return i}getShipStart(t,e){const{ship:n}=this.board[t][e];return{startX:n.startX,startY:n.startY}}isHit(t,e){return this.board[t][e].isHit}isShip(t,e){return null!=this.board[t][e].ship}isSunk(t,e){const{ship:n}=this.board[t][e];if(null!=n)return n.isSunk()}getShip(t,e){return this.board[t][e].ship}getShipAdjacentCoords(t,e){const{ship:n}=this.board[t][e];if(null==n)return[];const{startX:r,startY:i,isAxisX:s,length:a}=n;return c(r,i,s,a)}cleanBoard(){this.board=f()}},g=class extends m{constructor(t,e){super(),this.name=t,this.isAi=e}},y=document.getElementById("board-wrapper0"),S=document.getElementById("board-wrapper1"),v=document.getElementById("board0"),A=document.getElementById("board1"),E=function(t){0===t?(v.remove(),y.appendChild(v),A.remove(),S.appendChild(A)):1===t&&(A.remove(),y.appendChild(A),v.remove(),S.appendChild(v))},x=function(t){const e=document.getElementById(`board-numbers${t}`),n=document.getElementById(`board-letters${t}`);!function(t){for(let e=0;e<10;e+=1){const n=document.createElement("div");n.textContent=e,t.append(n)}}(e),function(t){for(let e=0;e<10;e+=1){const n=document.createElement("div"),r=e+65;n.textContent=String.fromCharCode(r),t.append(n)}}(n)},w=class{constructor(t,n,r,i){this.player=new g(t,n),this.boardUi=new s(r,i),this.id=i,x(i),e().subscribe("ship-dropped",((t,e)=>{const{oldX:n,oldY:r,newX:i,newY:s,boardId:a}=e;a===this.id&&(n===i&&r===s||this.relocateShip(n,r,i,s))})),e().subscribe("ship-rotated",((t,e)=>{const{shipX:n,shipY:r,boardId:i}=e;i===this.id&&this.rotateShip(n,r)}))}receiveAttack(t,e){this.player.receiveAttack(t,e),this.boardUi.receiveAttack(t,e),!0===this.player.isSunk(t,e)&&this.explodeShip(t,e)}calculateAttack(){return this.player.calculateAttack()}areAllSunk(){return this.player.areAllSunk()}cleanBoard(){this.player.cleanBoard(),this.boardUi.cleanBoard()}isAi(){return this.player.isAi}isHit(t,e){return this.player.isHit(t,e)}isShip(t,e){return this.player.isShip(t,e)}placeShip(t,e,n,r){this.player.placeShip(t,e,n,r),this.boardUi.placeShip(t,e,n,r)}relocateShip(t,e,n,r){const{isAxisX:i,length:s}=this.player.getShip(t,e);this.player.removeShip(t,e),this.player.isLegalToPlaceShip(n,r,i,s)?(this.boardUi.removeShip(t,e),this.player.placeShip(n,r,i,s),this.boardUi.placeShip(n,r,i,s)):this.player.placeShip(t,e,i,s)}rotateShip(t,e){const{isAxisX:n,length:r}=this.player.getShip(t,e);this.player.removeShip(t,e),this.player.isLegalToPlaceShip(t,e,!n,r)?(this.boardUi.removeShip(t,e),this.player.placeShip(t,e,!n,r),this.boardUi.placeShip(t,e,!n,r)):this.player.placeShip(t,e,n,r)}removeShip(t,e){this.player.removeShip(t,e),this.boardUi.removeShip(t,e)}getName(){return this.player.name}enableDragging(){this.boardUi.enableDragging()}disableDragging(){this.boardUi.disableDragging()}showShips(){this.boardUi.showShips()}hideShips(){this.boardUi.hideShips()}placeRandomShips(){(function(){let t=function(t){const e=[...t];for(let t=e.length-1;t>0;t-=1){const n=Math.floor((t+1)*Math.random()),r=e[n];e[n]=e[t],e[t]=r}return e}(u());const e=[];return[4,3,3,2,2,2,1,1,1,1].forEach((n=>{const r=Math.random()<.5;for(let i=0;i<t.length;i+=1){const[s,a]=t[i],l=[s,a,r,n],d=h(...l).toString();if(t.some((t=>{const e=t.toString();return d===e}))){const n=c(...l),r=o(...l),i=n.concat(r);t=p(t,i),e.push(l);break}}})),e})().forEach((t=>{this.player.placeShip(...t),this.boardUi.placeShip(...t)}))}explodeShip(t,e){this.player.getShipAdjacentCoords(t,e).forEach((([t,e])=>{this.player.receiveAttack(t,e),this.boardUi.receiveAttack(t,e)}))}changePlayer(t,e){this.player.name=t,this.player.isAi=e}},k=document.getElementById("board0"),B=document.getElementById("board1"),O=new w("Player 1",!1,k,0),I=new w("Player 2",!0,B,1),L=[O,I];let C=0,P=1,N=L[C],j=L[P];const q=function(){P=C,C=0===C?1:0,N=L[C],j=L[P]},U=function(){return P},X=function(){return N.areAllSunk()||j.areAllSunk()},D=function(){return N},H=function(){return j},T=function(){let t=null;const e=N.areAllSunk(),n=j.areAllSunk();return e?t=j:n&&(t=N),t},Y=function(t,e,n,r){O.changePlayer(t,e),I.changePlayer(n,r)},$=function(){O.cleanBoard(),I.cleanBoard(),O.placeRandomShips(),I.placeRandomShips(),C=0,P=1,N=L[C],j=L[P]},M=function(){O.cleanBoard(),I.cleanBoard()},R=document.getElementById("control-panel"),z=document.getElementById("confirm-button"),_=document.getElementById("random-button");z.addEventListener("click",(()=>{e().publish("placement-confirmed")})),_.addEventListener("click",(()=>{e().publish("replace-ships-clicked")}));const J=function(){R.classList.add("control-panel-active")},F=function(){R.classList.remove("control-panel-active")},G=document.getElementById("switchscreen"),K=document.getElementById("switchscreen-player");function Q(){G.classList.remove("modal-active")}document.getElementById("switchscreen-play").addEventListener("click",(()=>{Q()}));const V=function(t){K.textContent=`${t}'s turn`},W=function(){G.classList.add("modal-active")};async function Z(){const t=D(),n=H();t.isAi()||(n.isAi()||(V(t.getName()),W()),E(t.id),t.showShips(),t.enableDragging(),n.hideShips(),await new Promise((t=>{const n=e().subscribe("placement-confirmed",(()=>{t(),e().unsubscribe(n)}))})),t.disableDragging()),q()}const tt=document.getElementById("startscreen"),et=document.getElementById("startscreen-name-0"),nt=document.getElementById("startscreen-name-1"),rt=document.getElementById("startscreen-mode-0"),it=document.getElementById("startscreen-mode-1"),st=[rt,it],at=document.getElementById("startscreen-switch"),ot=document.getElementById("startscreen-play");let ct=[!1,!0];function lt(){tt.classList.remove("modal-active")}function dt(t,e){t||e?t?(et.textContent="Computer",nt.textContent="Human"):e&&(et.textContent="Human",nt.textContent="Computer"):(et.textContent="Player 1",nt.textContent="Player 2")}function ut(){return rt.checked}st.forEach((t=>{t.addEventListener("change",(()=>{ut()?(ct=[!1,!0],at.classList.add("startscreen-switch-active")):(ct=[!1,!1],at.classList.remove("startscreen-switch-active")),dt(...ct)}))})),at.addEventListener("click",(()=>{ut()&&(ct=ct.toReversed()),dt(...ct)})),ot.addEventListener("click",(()=>{const t=[et.textContent,nt.textContent],n=[t[0],ct[0]],r=[t[1],ct[1]];e().publish("start-game",[n,r]),lt()}));const ht=function(){tt.classList.add("modal-active")},pt=document.getElementById("endscreen"),bt=document.getElementById("endscreen-winner");function ft(){pt.classList.remove("modal-active")}document.getElementById("endscreen-play-button").addEventListener("click",(()=>{ft(),e().publish("play-again-clicked")}));const mt=function(){pt.classList.add("modal-active")},gt=function(t){bt.textContent=`The winner is ${t}`},yt=document.getElementById("message-board"),St=function(){yt.textContent="Place your ships"},vt=function(){yt.textContent="Attack your enemy"};e().subscribe("game-loop-ended",(()=>{const t=T();gt(t.getName()),mt()})),e().subscribe("start-game",(async(t,n)=>{const[r,i]=n;Y(...r,...i),$(),St(),await async function(){J(),await Z(),await Z(),E(0);const t=D(),n=H();t.hideShips(),n.hideShips(),F(),e().publish("placement-phase-ended")}(),vt(),async function(){let t=!0,n=X();for(;!X();){e().publish("round-started",{isFirstRound:t});const r=D(),i=H();if(r.isAi()){let t=!0;for(;t&&!n;){const[e,r]=i.calculateAttack();i.receiveAttack(e,r),t=i.isShip(e,r),n=X()}}else{let t=!0;for(;t&&!n;){const r=await new Promise((t=>{const n=e().subscribe("square-clicked",((r,i)=>{const{boardId:s,x:a,y:o}=i,c=H(),l=U(),d=c.isHit(a,o);t(d||l!==s?null:{boardId:s,x:a,y:o}),e().unsubscribe(n)}))}));if(r){const{x:e,y:s}=r;i.receiveAttack(e,s),t=i.isShip(e,s),n=X()}}}q(),t&&(t=!1)}e().publish("game-loop-ended")}()})),e().subscribe("replace-ships-clicked",(()=>{const t=D();t.cleanBoard(),t.placeRandomShips()})),e().subscribe("round-started",(()=>{const t=D(),e=H(),n=!t.isAi();n&&!e.isAi()?(e.hideShips(),t.showShips(),E(t.id),V(t.getName()),W()):n&&(e.hideShips(),t.showShips(),E(t.id))})),e().subscribe("play-again-clicked",(()=>{M(),ht()}))})()})();